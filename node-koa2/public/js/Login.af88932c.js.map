{"version":3,"sources":["webpack:///./src/views/Login/index.module.less?38dd","webpack:///./src/assets/image/logo.png","webpack:///./src/api/user.ts","webpack:///./src/utils/validate.ts","webpack:///./src/views/Login/index.jsx"],"names":["module","exports","ApiLogin","data","service","post","ApiGetVerify","phone","get","TestPhone","reg","test","Vue","extend","name","focusName","code","sendingCodeStatus","sendingCodeText","leftTime","handleTimer","submitStatus","methods","handlePhoneChange","event","this","target","value","handleCodeChange","handleInputFocus","key","handleInputBlur","validatePhone","$toast","handleSendCode","$data","getLeftTime","then","resp","result","catch","err","console","log","undefined","clearInterval","setInterval","handleSubmit","length","token","user","setToken","$store","dispatch","$router","replace","path","render","styles","loginWrapper","content","logo","Logo","checkBox","checkBoxItem","classNames","checkBoxInput","focus","checkBoxBtn"],"mappings":"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","file":"js/Login.af88932c.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"loginWrapper\":\"index-module_loginWrapper_2zURn\",\"logo\":\"index-module_logo_19d6B\",\"checkBox\":\"index-module_checkBox__Jagz\",\"checkBoxItem\":\"index-module_checkBoxItem_1DWu8\",\"checkBoxInput\":\"index-module_checkBoxInput_3uA1X\",\"checkBoxBtn\":\"index-module_checkBoxBtn_maeTX\",\"focus\":\"index-module_focus_2Dsgj\",\"check\":\"index-module_check_2fFGN\"};","module.exports = __webpack_public_path__ + \"img/logo.82b9c7a5.png\";","import service from \"@/axios/service\";\r\n\r\ntype Login = {\r\n  phone: number;\r\n  verify: number;\r\n};\r\n\r\n/**\r\n * 登录操作\r\n * @param {Object} data\r\n * @param {Number} data.phone 手机号码\r\n * @param {Number} data.verify 验证码\r\n */\r\nexport function ApiLogin(data: Login) {\r\n  return service.post(\"/api/user/login\", data);\r\n}\r\n\r\n/**\r\n * 获取验证码\r\n * @param {Number} data.phone 手机号码\r\n */\r\nexport function ApiGetVerify(phone: number) {\r\n  return service.get(\"/api/user/verify\", {\r\n    phone\r\n  });\r\n}\r\n","// 校验手机\r\nexport function TestPhone(phone) {\r\n  const reg = /^((13[0-9])|(15[^4])|(166)|(17[0-8])|(18[0-9])|(19[8-9])|(14[5|7]))\\d{8}$/;\r\n  return reg.test(phone);\r\n}\r\n","import Vue from \"vue\";\r\nimport Logo from \"@/assets/image/logo.png\";\r\nimport classNames from \"classnames\";\r\nimport styles from \"./index.module.less\";\r\nimport { ApiGetVerify, ApiLogin } from \"@/api/user\";\r\nimport { TestPhone } from \"@/utils/validate\";\r\nimport { setToken } from \"@/utils\";\r\n\r\nexport default Vue.extend({\r\n  name: \"Login\",\r\n  data() {\r\n    return {\r\n      focusName: \"\",\r\n      phone: \"\",\r\n      code: \"\",\r\n      sendingCodeStatus: false,\r\n      sendingCodeText: \"\",\r\n      leftTime: 120,\r\n      handleTimer: null,\r\n      submitStatus: false\r\n    };\r\n  },\r\n  methods: {\r\n    // 手机号码输入操作\r\n    handlePhoneChange(event) {\r\n      this.phone = event.target.value;\r\n    },\r\n\r\n    // 验证码输入操作\r\n    handleCodeChange(event) {\r\n      this.code = event.target.value;\r\n    },\r\n\r\n    // 输入框获取焦点\r\n    handleInputFocus(key) {\r\n      this.focusName = key;\r\n    },\r\n\r\n    // 输入框失去焦点\r\n    handleInputBlur() {\r\n      this.focusName = \"\";\r\n    },\r\n\r\n    validatePhone(phone) {\r\n      if (!phone) {\r\n        this.$toast(\"请输入您的手机号码\");\r\n        return false;\r\n      }\r\n      if (!TestPhone(phone)) {\r\n        this.$toast(\"您的号码输入错误\");\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    // 发送验证码\r\n    handleSendCode() {\r\n      const { phone } = this.$data;\r\n      if (!this.validatePhone(phone)) {\r\n        return;\r\n      }\r\n\r\n      this.getLeftTime();\r\n      ApiGetVerify(phone)\r\n        .then(resp => {\r\n          if (resp.code === 0) {\r\n            this.$toast(\"验证码为:\" + resp.result);\r\n            this.getLeftTime();\r\n          }\r\n        })\r\n        .catch(err => {\r\n          console.log(err);\r\n        });\r\n    },\r\n\r\n    // 倒计时获取剩余时间\r\n    getLeftTime() {\r\n      let leftTime = this.$data.leftTime;\r\n      this.sendingCodeStatus = true;\r\n      this.sendingCodeText = `${leftTime} s`;\r\n      if (this.$data.handleTimer !== undefined) {\r\n        clearInterval(this.$data.handleTimer);\r\n        this.handleTimer = null;\r\n      }\r\n      const handleTimer = setInterval(() => {\r\n        leftTime--;\r\n        if (leftTime < 0) {\r\n          this.sendingCodeStatus = false;\r\n          this.sendingCodeText = \"获取验证码\";\r\n          leftTime = this.$data.leftTime;\r\n          clearInterval(handleTimer);\r\n        } else {\r\n          this.sendingCodeText = `${leftTime} s`;\r\n        }\r\n      }, 1000);\r\n      this.handleTimer = handleTimer;\r\n    },\r\n\r\n    async handleSubmit() {\r\n      const { phone, code } = this.$data;\r\n      if (!this.validatePhone(phone)) {\r\n        return;\r\n      }\r\n      if (code.length === 0) {\r\n        return this.$toast(\"请输入验证码\");\r\n      }\r\n      ApiLogin({ phone, code })\r\n        .then(resp => {\r\n          if (resp.code === 0) {\r\n            this.$toast(\"欢迎回来!!!\");\r\n            const { token, user } = resp.result;\r\n            setToken(token);\r\n            this.$store.dispatch(\"updateUser\", user);\r\n            this.$router.replace({ path: \"/\" });\r\n          }\r\n        })\r\n        .catch(err => {\r\n          console.log(err);\r\n        });\r\n    }\r\n  },\r\n  render() {\r\n    const {\r\n      focusName,\r\n      phone,\r\n      code,\r\n      sendingCodeStatus,\r\n      sendingCodeText,\r\n      submitStatus\r\n    } = this.$data;\r\n\r\n    return (\r\n      <EContainer>\r\n        <div class={styles.loginWrapper}>\r\n          <div class={styles.content}>\r\n            <div class={styles.logo}>\r\n              <img src={Logo} alt=\"logo\" title=\"logo\" />\r\n            </div>\r\n          </div>\r\n          <div class={styles.checkBox}>\r\n            <div class={styles.checkBoxItem}>\r\n              <label>手机号码</label>\r\n              <div\r\n                class={classNames(styles.checkBoxInput, {\r\n                  [styles.focus]: \"phone\" === focusName\r\n                })}\r\n              >\r\n                <input\r\n                  type=\"number\"\r\n                  placeholder=\"请输入手机号码\"\r\n                  autoFocus\r\n                  value={phone}\r\n                  onInput={this.handlePhoneChange}\r\n                  onFocus={() => this.handleInputFocus(\"phone\")}\r\n                  onBlur={this.handleInputBlur}\r\n                />\r\n              </div>\r\n            </div>\r\n            <div class={styles.checkBoxItem}>\r\n              <label>验证码</label>\r\n              <div\r\n                class={classNames(styles.checkBoxInput, {\r\n                  [styles.focus]: \"code\" === focusName\r\n                })}\r\n              >\r\n                <input\r\n                  type=\"number\"\r\n                  placeholder=\"请输入验证码\"\r\n                  value={code}\r\n                  onInput={this.handleCodeChange}\r\n                  onFocus={() => this.handleInputFocus(\"code\")}\r\n                  onBlur={this.handleInputBlur}\r\n                />\r\n                <div class={styles.checkBoxBtn}>\r\n                  <van-button\r\n                    type=\"primary\"\r\n                    size=\"small\"\r\n                    block\r\n                    onClick={() => this.handleSendCode()}\r\n                    disabled={sendingCodeStatus}\r\n                  >\r\n                    {sendingCodeStatus ? sendingCodeText : \"发送验证码\"}\r\n                  </van-button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <van-button\r\n              type=\"info\"\r\n              block\r\n              onClick={this.handleSubmit}\r\n              disabled={submitStatus}\r\n            >\r\n              提交\r\n            </van-button>\r\n          </div>\r\n        </div>\r\n      </EContainer>\r\n    );\r\n  }\r\n});\r\n"],"sourceRoot":""}